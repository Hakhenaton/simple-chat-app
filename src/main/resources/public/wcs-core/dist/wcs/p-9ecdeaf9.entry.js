import{r as t,c as i,h as s,H as e,g as a}from"./p-a2df3a49.js";const n=["m","l"];function r(t){return n.includes(t)}const h=":host{display:block}:host .display-none{display:none !important}:host .label{margin-bottom:var(--wcs-base-margin);font-weight:500;font-size:var(--wcs-editable-field-font-size);color:var(--wcs-gray-light)}:host .edit-container{display:flex;width:100%}:host .display-container{box-sizing:border-box;height:var(--wcs-editable-field-host-height);white-space:break-spaces;display:flex;justify-content:space-between;align-items:center;background-color:var(--wcs-light);border-radius:var(--wcs-border-radius);font-size:var(--wcs-editable-field-font-size);line-height:1.5;font-weight:500;color:var(--wcs-gray);padding:var(--wcs-editable-field-host-padding);transition:0.175s all;border:solid 2px transparent}:host .display-container wcs-mat-icon{display:none}:host .load-container{box-sizing:border-box;height:var(--wcs-editable-field-host-height);white-space:pre;display:flex;justify-content:space-between;background-color:var(--wcs-light);border-radius:var(--wcs-border-radius);font-size:var(--wcs-editable-field-font-size);line-height:1.5;font-weight:500;color:var(--wcs-gray);padding:var(--wcs-editable-field-host-padding);transition:0.175s all;border:solid 2px transparent;align-items:center}:host wcs-spinner{height:24px;width:24px}:host .readonly-icon{fill:var(--wcs-text-medium)}:host([readonly]) .display-container{color:var(--wcs-gray-light)}:host(:not([readonly])) .display-container:hover{color:var(--wcs-primary);cursor:pointer;border:dashed 2px var(--wcs-primary)}:host(:not([readonly])) .display-container:hover wcs-mat-icon{display:flex;align-items:center}:host([size=l]){--wcs-editable-field-host-padding:var(--wcs-padding-l) calc(var(--wcs-padding) - var(--wcs-border-size));--wcs-editable-field-host-height:var(--wcs-size-l);--wcs-editable-field-font-size:1.0625rem}:host([size=m]){--wcs-editable-field-host-padding:var(--wcs-padding-m) calc(var(--wcs-padding) - var(--wcs-border-size));--wcs-editable-field-host-height:var(--wcs-size-m);--wcs-editable-field-font-size:1rem}";var o;(function(t){t[t["DISPLAY"]=0]="DISPLAY";t[t["EDIT"]=1]="EDIT";t[t["LOAD"]=2]="LOAD"})(o||(o={}));const l=class{constructor(s){t(this,s);this.wcsChange=i(this,"wcsChange",7);this.spiedElement=null;this.currentValue=null;this.currentState=o.DISPLAY;this.type="input";this.label=undefined;this.readonly=false;this.value=undefined;this.validateFn=undefined;this.formatFn=undefined;this.errorMsg=null;this.size="m";this.isError=false}componentWillLoad(){if(!r(this.size)){console.error(`Invalid size value for wcs-editable-field : "${this.size}". Must be one of "${n.join(", ")}"`);this.size="m"}this.currentValue=this.value}componentDidRender(){const t=this.el.shadowRoot.querySelector("slot").assignedElements();switch(this.type){case"input":this.initWithInput(t);break;case"textarea":this.initWithTextArea(t);break;case"select":this.initWithSelect(t);break}}initWithInput(t){const i=t.filter((t=>t.tagName==="WCS-INPUT"))[0];if(!i)throw new Error("You must provide a slotted input element to handle edition");this.spiedElement=i;this.addChangeHandlerForWcsComponents(this.spiedElement);this.spiedElement.addEventListener("keydown",(t=>{if(t.key==="Enter"){this.sendCurrentValue()}if(t.key==="Escape"){this.discardChanges()}}))}initWithTextArea(t){const i=t.filter((t=>t.tagName==="WCS-TEXTAREA"))[0];if(!i)throw new Error("You must provide a slotted textarea element to handle edition");this.spiedElement=i;this.addChangeHandlerForWcsComponents(this.spiedElement);this.spiedElement.addEventListener("keydown",(t=>{if(t.key==="Enter"&&t.ctrlKey){this.sendCurrentValue()}if(t.key==="Escape"){this.discardChanges()}}))}initWithSelect(t){const i=t.filter((t=>t.tagName==="WCS-SELECT"))[0];if(!i)throw new Error("You must provide a slotted select element to handle edition");this.spiedElement=i;this.addChangeHandlerForWcsComponents(this.spiedElement)}addChangeHandlerForWcsComponents(t){t.addEventListener("wcsChange",(t=>{t.stopImmediatePropagation();this.currentValue=t.detail.value;if(this.validateFn){this.isError=!this.validateFn(this.currentValue)}}))}sendCurrentValue(){if(this.currentState===o.EDIT){if(this.value===this.currentValue){this.currentState=o.DISPLAY}else{this.isError=this.validateFn?!this.validateFn(this.currentValue):false;if(!this.isError){this.currentState=o.LOAD;this.wcsChange.emit({newValue:this.currentValue,successHandler:()=>this.forceDisplayStateAndValidate(),errorhandler:()=>this.errorHandler()})}}}}discardChanges(){this.currentValue=this.value;this.currentState=o.DISPLAY;this.isError=false}forceDisplayStateAndValidate(){if(this.currentState===o.LOAD){this.value=this.currentValue;this.currentState=o.DISPLAY}else{throw new Error("You cannot set display state from "+o[this.currentState]+" state")}}onWindowClickEvent(t){if(!this.clickInsideComponent(t)){if(this.currentState===o.EDIT){if(this.isError){this.discardChanges()}else{this.sendCurrentValue()}}}}clickInsideComponent(t){return t.x>=this.el.getBoundingClientRect().x&&t.x<=this.el.getBoundingClientRect().x+this.el.getBoundingClientRect().width&&t.y>=this.el.getBoundingClientRect().y&&t.y<=this.el.getBoundingClientRect().y+this.el.getBoundingClientRect().height}errorHandler(){this.discardChanges()}onValueChange(){this.currentState=o.DISPLAY}onDisplayContainerClick(){if(this.currentState===o.DISPLAY&&this.readonly===false){this.currentState=o.EDIT;this.spiedElement["value"]=this.currentValue;if(this.validateFn){this.isError=!this.validateFn(this.currentValue)}const t=20;setTimeout((()=>{if(this.type==="input"){this.spiedElement.setFocus()}else if(this.type==="textarea"){this.spiedElement.fitContent();this.spiedElement.setFocus()}}),t)}}render(){const{formattedValue:t,formattedCurrentValue:i}=this.formatValues();return s(e,null,s("div",{class:"label"},this.label),s("div",{class:"display-container "+(this.currentState!==o.DISPLAY?"display-none":""),onClick:()=>this.onDisplayContainerClick()},t,s("wcs-mat-icon",{icon:"edit",size:"s"}),this.readonly?this.getReadonlySvgIcon():null),s("div",{class:"load-container "+(this.currentState!==o.LOAD?"display-none":"")},i,s("wcs-spinner",null)),s("wcs-form-field",{"is-error":this.isError,class:"edit-container "+(this.currentState!==o.EDIT?"display-none":"")},s("slot",null),this.isError&&this.errorMsg?s("wcs-error",null,this.errorMsg):null))}getReadonlySvgIcon(){return s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"24",viewBox:"0 0 27 25",class:"readonly-icon"},s("path",{d:"M26.79,25.05H1.21a.73.73,0,0,0,0,1.45H26.79a.73.73,0,0,0,0-1.45Z",transform:"translate(-0.5 -1.5)"}),s("path",{d:"M19.8,8.87h-.61V6.73a5.23,5.23,0,0,0-10.46,0V8.87H8.2a1.63,1.63,0,0,0-1.63,1.62V21.32A1.62,1.62,0,0,0,8.2,22.94H19.8a1.62,1.62,0,0,0,1.63-1.62V10.49A1.63,1.63,0,0,0,19.8,8.87ZM10.93,6.73a3,3,0,1,1,6.06,0V8.87H10.93Zm3,14.15a5,5,0,1,1,5-5A5,5,0,0,1,14,20.88Z",transform:"translate(-0.5 -1.5)"}),s("path",{d:"M14,12.62a3.29,3.29,0,1,0,3.29,3.29A3.29,3.29,0,0,0,14,12.62Zm0,4.75a1.47,1.47,0,1,1,1.47-1.46A1.46,1.46,0,0,1,14,17.37Z",transform:"translate(-0.5 -1.5)"}))}formatValues(){let t=this.value;let i=this.currentValue;if(this.formatFn){t=this.formatFn(this.value);i=this.formatFn(this.currentValue)}if(Array.isArray(this.value)){t=this.value.join(", ")}if(Array.isArray(this.currentValue)){i=this.currentValue.join(", ")}return{formattedValue:t?s("span",null,t):s("span",null),formattedCurrentValue:i?s("span",null,i):s("span",null)}}get el(){return a(this)}static get watchers(){return{value:["onValueChange"]}}};l.style=h;export{l as wcs_editable_field};
//# sourceMappingURL=p-9ecdeaf9.entry.js.map